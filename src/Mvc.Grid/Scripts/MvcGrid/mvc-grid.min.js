/*!
 * Mvc.Grid 5.0.0
 * https://github.com/NonFactors/MVC5.Grid
 *
 * Copyright Â© NonFactors
 *
 * Licensed under the terms of the MIT License
 * http://www.opensource.org/licenses/mit-license.php
 */
function MvcGridExtends(n,t){function i(){this.constructor=n}Object.setPrototypeOf(n,t);n.prototype=(i.prototype=t.prototype,new i)}var MvcGrid=function(){function n(n,t){var u,o,e,f,r,i;if(this.columns=[],this.element=n,t=t||{},this.data=t.data,this.name=n.attr("id")||"",this.rowClicked=t.rowClicked,this.methods={reload:this.reload},this.reloadEnded=t.reloadEnded,this.reloadFailed=t.reloadFailed,this.reloadStarted=t.reloadStarted,this.requestType=t.requestType||"get",this.prefix=this.name==""?"":this.name+"-",this.sourceUrl=t.sourceUrl||n.data("source-url")||"",this.filters=$.extend({Text:new MvcGridTextFilter,Date:new MvcGridDateFilter,Number:new MvcGridNumberFilter,Boolean:new MvcGridBooleanFilter},t.filters),this.sourceUrl?(u=this.sourceUrl.indexOf("?"),u>-1?(this.query=this.sourceUrl.substring(u+1),this.sourceUrl=this.sourceUrl.substring(0,u)):this.query=t.query||""):this.query=window.location.search.replace("?",""),o=!this.sourceUrl||(t.isLoaded==null?n.children().length>0:t.isLoaded),t.reload||!o){this.reload();return}for(e=n.find("th"),f=0;f<e.length;f++)r=this.createColumn($(e[f])),this.bindFilter(r),this.bindSort(r),this.cleanup(r),this.columns.push(r);i=n.find(".mvc-grid-pager");i.length>0&&(this.pager={currentPage:i.find("li.active").data("page")||0,showPageSizes:i.data("show-page-sizes")=="True",rowsPerPage:i.find(".mvc-grid-pager-rows"),pages:i.find("li:not(.disabled)"),element:i});this.bindPager();this.bindGrid();this.clean()}return n.prototype={createColumn:function(n){var t={};return t.header=n,t.name=n.data("name")||"",n.data("filter")=="True"&&(t.filter={isMulti:n.data("filter-multi")=="True",operator:n.data("filter-operator")||"",name:n.data("filter-name")||"",first:{type:n.data("filter-first-type")||"",val:n.data("filter-first-val")||""},second:{type:n.data("filter-second-type")||"",val:n.data("filter-second-val")||""}}),n.data("sort")=="True"&&(t.sort={firstOrder:n.data("sort-first")||"",order:n.data("sort-order")||""}),t},set:function(n){for(var t in n)this.hasOwnProperty(t)&&(t=="filters"?this.filters=$.extend(this.filters,n.filters):t=="sourceUrl"?(n.hasOwnProperty("query")||(this.query=""),this.sourceUrl=n.sourceUrl):this[t]=n[t]);n.reload&&this.reload()},bindFilter:function(n){if(n.filter){var t=this;n.header.find(".mvc-grid-filter").on("click.mvcgrid",function(){t.renderFilter(n)})}},bindSort:function(n){if(n.sort){var t=this;n.header.on("click.mvcgrid",function(i){var r=$(i.target||i.srcElement);r.hasClass("mvc-grid-filter")||r.parents(".mvc-grid-filter").length!=0||(t.applySort(n),t.reload())})}},bindPager:function(){var n=this;if(n.pager){n.pager.rowsPerPage.on("change.mvcgrid",function(){n.applyPage(n.pager.currentPage);n.reload()});n.pager.pages.on("click.mvcgrid","a",function(n){n.preventDefault()});n.pager.pages.on("click.mvcgrid",function(){var t=$(this).data("page");t&&(n.applyPage(t),n.reload())})}},bindGrid:function(){var n=this;n.element.find("tbody tr:not(.mvc-grid-empty-row)").on("click.mvcgrid",function(t){for(var f,u=$(this).find("td"),r=[],i=0;i<n.columns.length;i++)f=n.columns[i],i<u.length&&(r[f.name]=$(u[i]).text());n.rowClicked&&n.rowClicked(this,r,t);$(this).trigger("rowclick",[r,n,t])})},reload:function(){var n=this;n.element.trigger("reloadStarted",[n]);n.reloadStarted&&n.reloadStarted();n.sourceUrl?$.ajax({cache:!1,data:n.data,type:n.requestType,url:n.sourceUrl+"?"+n.query}).done(function(t){n.element.hide();n.element.after(t);var i=n.element.next(".mvc-grid").mvcgrid({reloadStarted:n.reloadStarted,reloadFailed:n.reloadFailed,reloadEnded:n.reloadEnded,requestType:n.requestType,rowClicked:n.rowClicked,sourceUrl:n.sourceUrl,filters:n.filters,query:n.query,data:n.data,isLoaded:!0}).data("mvc-grid");n.element.remove();i.element.trigger("reloadEnded",[i]);i.reloadEnded&&i.reloadEnded()}).fail(function(t){n.element.trigger("reloadFailed",[n,t]);n.reloadFailed&&n.reloadFailed(t)}):window.location.href="?"+n.query},renderFilter:function(n){var i=this,r=i.filters[n.filter.name],t=$("body").children(".mvc-grid-popup");if($(window).off("resize.mvcgrid"),$(window).off("click.mvcgrid"),r){r.render(i,t,n.filter);r.init(i,n,t);i.setFilterPosition(n,t);t.addClass("open");$(window).on("click.mvcgrid",function(n){var i=$(n.target||n.srcElement);i.hasClass("mvc-grid-filter")||i.parents(".mvc-grid-popup").length!=0||i.is('[class*="ui-datepicker"]')||i.parents('[class*="ui-datepicker"]').length!=0||($(window).off("click.mvcgrid"),t.removeClass("open"))});$(window).on("resize.mvcgrid",function(){t.hasClass("open")&&(t.removeClass("open"),i.setFilterPosition(n,t),t.addClass("open"))})}else t.removeClass("open")},setFilterPosition:function(n,t){var i=n.header.find(".mvc-grid-filter"),f=$(document).width(),s=t.find(".popup-arrow"),r=i.offset().left,h=i.offset().top,c=i.height(),e=t.width(),l=h+c/2+14,u=r-8,o=12;r+e+5>f&&(u=f-e-5,o=r-u+4);s.css("left",o+"px");t.css("left",u+"px");t.css("top",l+"px")},cancelFilter:function(n){this.queryRemove(this.prefix+"Page");this.queryRemove(this.prefix+"Rows");this.queryRemoveStartingWith(this.prefix+n.name+"-")},applyFilter:function(n){this.cancelFilter(n);this.queryAdd(this.prefix+n.name+"-"+n.filter.first.type,n.filter.first.val);n.filter.isMulti&&(this.queryAdd(this.prefix+n.name+"-Op",n.filter.operator),this.queryAdd(this.prefix+n.name+"-"+n.filter.second.type,n.filter.second.val));this.pager&&this.pager.showPageSizes&&this.queryAdd(this.prefix+"Rows",this.pager.rowsPerPage.val())},applySort:function(n){this.queryRemove(this.prefix+"Sort");this.queryRemove(this.prefix+"Order");this.queryAdd(this.prefix+"Sort",n.name);var t=n.sort.order=="Asc"?"Desc":"Asc";!n.sort.order&&n.sort.firstOrder&&(t=n.sort.firstOrder);this.queryAdd(this.prefix+"Order",t)},applyPage:function(n){this.queryRemove(this.prefix+"Page");this.queryRemove(this.prefix+"Rows");this.queryAdd(this.prefix+"Page",n);this.pager.showPageSizes&&this.queryAdd(this.prefix+"Rows",this.pager.rowsPerPage.val())},queryAdd:function(n,t){this.query+=(this.query?"&":"")+encodeURIComponent(n)+"="+encodeURIComponent(t)},queryRemoveStartingWith:function(n){for(var u,f=encodeURIComponent(n),i=this.query.split("&"),r=[],t=0;t<i.length;t++)u=i[t].split("=")[0],i[t]&&u.indexOf(f)!=0&&r.push(i[t]);this.query=r.join("&")},queryRemove:function(n){for(var u,f=encodeURIComponent(n),i=this.query.split("&"),r=[],t=0;t<i.length;t++)u=i[t].split("=")[0],i[t]&&u!=f&&r.push(i[t]);this.query=r.join("&")},cleanup:function(n){var t=n.header;t.removeAttr("data-name");t.removeAttr("data-filter");t.removeAttr("data-filter-name");t.removeAttr("data-filter-multi");t.removeAttr("data-filter-operator");t.removeAttr("data-filter-first-val");t.removeAttr("data-filter-first-type");t.removeAttr("data-filter-second-val");t.removeAttr("data-filter-second-type");t.removeAttr("data-sort");t.removeAttr("data-sort-order");t.removeAttr("data-sort-first")},clean:function(){this.element.removeAttr("data-source-url");this.pager&&this.pager.element.removeAttr("data-show-page-sizes")}},n}(),MvcGridFilter=function(){function n(){}return n.prototype={render:function(n,t,i){t.html('<div class="popup-arrow"><\/div><div class="popup-content"><div class="first-filter">'+this.renderFilter(i.first)+"<\/div>"+(i.isMulti?this.renderOperator(i,$.fn.mvcgrid.lang.Operator)+'<div class="second-filter">'+this.renderFilter(i.second)+"<\/div>":"")+this.renderActions($.fn.mvcgrid.lang.Filter)+"<\/div>")},renderFilter:function(n,t,i){var r=t.reduce(function(t,r){return t+'<option value="'+r+'"'+(n.type==r?' selected="selected"':"")+">"+i[r]+"<\/option>"},"");return'<div class="popup-group"><select class="mvc-grid-type">'+r+'<\/select><\/div><div class="popup-group"><input class="mvc-grid-input" value="'+n.val+'" /><\/div>'},renderOperator:function(n,t){return'<div class="operator-filter"><div class="popup-group"><select class="mvc-grid-operator"><option value="">'+t.Select+'<\/option><option value="And"'+(n.operator=="And"?' selected="selected"':"")+">"+t.And+'<\/option><option value="Or"'+(n.operator=="Or"?' selected="selected"':"")+">"+t.Or+"<\/option><\/select><\/div><\/div>"},renderActions:function(n){return'<div class="filter-actions"><button class="btn btn-success mvc-grid-apply" type="button">'+n.Apply+'<\/button><button class="btn btn-danger mvc-grid-cancel" type="button">'+n.Remove+"<\/button><\/div>"},init:function(n,t,i){this.bindValue(n,t,i);this.bindApply(n,t,i);this.bindCancel(n,t,i)},bindValue:function(n,t,i){var f=this,u=i.find(".mvc-grid-input"),r;u.on("keyup.mvcgrid",function(r){f.isValid(this.value)?($(this).removeClass("invalid"),r.which==13&&f.apply(n,t,i)):$(this).addClass("invalid")});for(r=0;r<u.length;r++)f.isValid(u[r].value)||$(u[r]).addClass("invalid")},bindApply:function(n,t,i){var r=this;i.find(".mvc-grid-apply").on("click.mvcgrid",function(){r.apply(n,t,i)})},bindCancel:function(n,t,i){var r=this;i.find(".mvc-grid-cancel").on("click.mvcgrid",function(){r.cancel(n,t,i)})},isValid:function(){return!0},apply:function(n,t,i){i.removeClass("open");t.filter.operator=i.find(".mvc-grid-operator").val();t.filter.first.type=i.find(".first-filter .mvc-grid-type").val();t.filter.first.val=i.find(".first-filter .mvc-grid-input").val();t.filter.second.type=i.find(".second-filter .mvc-grid-type").val();t.filter.second.val=i.find(".second-filter .mvc-grid-input").val();n.applyFilter(t);n.reload()},cancel:function(n,t,i){i.removeClass("open");(t.filter.first.type||t.filter.second.type)&&(n.cancelFilter(t),n.reload())}},n}(),MvcGridTextFilter=function(n){function t(){return n.apply(this)}return MvcGridExtends(t,n),t.prototype.renderFilter=function(t){return n.prototype.renderFilter.call(this,t,["Contains","Equals","NotEquals","StartsWith","EndsWith"],$.fn.mvcgrid.lang.Text)},t}(MvcGridFilter),MvcGridNumberFilter=function(n){function t(){return n.apply(this)}return MvcGridExtends(t,n),t.prototype.renderFilter=function(t){return n.prototype.renderFilter.call(this,t,["Equals","NotEquals","LessThan","GreaterThan","LessThanOrEqual","GreaterThanOrEqual"],$.fn.mvcgrid.lang.Number)},t.prototype.isValid=function(n){return!n||/^(?=.*\d+.*)[-+]?\d*[.,]?\d*$/.test(n)},t}(MvcGridFilter),MvcGridDateFilter=function(n){function t(){return n.apply(this)}return MvcGridExtends(t,n),t.prototype.renderFilter=function(t){return n.prototype.renderFilter.call(this,t,["Equals","NotEquals","EarlierThan","EarlierThanOrEqual","LaterThan","LaterThanOrEqual"],$.fn.mvcgrid.lang.Date)},t.prototype.bindValue=function(t,i,r){$.fn.datepicker&&r.find(".mvc-grid-input").datepicker();n.prototype.bindValue.call(this,t,i,r)},t}(MvcGridFilter),MvcGridBooleanFilter=function(n){function t(){return n.apply(this)}return MvcGridExtends(t,n),t.prototype.renderFilter=function(n){var t=$.fn.mvcgrid.lang.Boolean;return'<div class="popup-group"><ul class="mvc-grid-boolean-filter"><li '+(n.val=="True"?'class="active" ':"")+'data-value="True">'+t.Yes+"<\/li><li "+(n.val=="False"?'class="active" ':"")+'data-value="False">'+t.No+"<\/li><\/ul><\/div>"},t.prototype.bindValue=function(n,t,i){i.find("li").on("click.mvcgrid",function(){$(this).addClass("active").siblings().removeClass("active")})},t.prototype.apply=function(n,t,i){i.removeClass("open");t.filter.first.type="Equals";t.filter.second.type="Equals";t.filter.operator=i.find(".mvc-grid-operator").val();t.filter.first.val=i.find(".first-filter li.active").data("value");t.filter.second.val=i.find(".second-filter li.active").data("value");n.applyFilter(t);n.reload()},t}(MvcGridFilter);$.fn.mvcgrid=function(n){var f=arguments,i,r,t,u;if(n==="instance"){for(i=[],r=0;r<this.length;r++)(t=$(this[r]).closest(".mvc-grid"),t.length)&&(u=t.data("mvc-grid"),u||t.data("mvc-grid",u=new MvcGrid(t,n)),i.push(u));return this.length<=1?i[0]:i}return this.each(function(){var i=$(this).closest(".mvc-grid"),t;i.length&&(t=i.data("mvc-grid"),t?typeof n=="string"?t.methods[n].apply(t,[].slice.call(f,1)):n&&t.set(n):(typeof n=="string"?(t=new MvcGrid(i),t.methods[n].apply(t,[].slice.call(f,1))):t=new MvcGrid(i,n),$.data(i[0],"mvc-grid",t)))})};$.fn.mvcgrid.lang={Text:{Contains:"Contains",Equals:"Equals",NotEquals:"Not equals",StartsWith:"Starts with",EndsWith:"Ends with"},Number:{Equals:"Equals",NotEquals:"Not equals",LessThan:"Less than",GreaterThan:"Greater than",LessThanOrEqual:"Less than or equal",GreaterThanOrEqual:"Greater than or equal"},Date:{Equals:"Equals",NotEquals:"Not equals",EarlierThan:"Earlier than",LaterThan:"Later than",EarlierThanOrEqual:"Earlier than or equal",LaterThanOrEqual:"Later than or equal"},Boolean:{Yes:"Yes",No:"No"},Filter:{Apply:"&#10004;",Remove:"&#10008;"},Operator:{Select:"",And:"and",Or:"or"}};$(function(){$("body").append('<div class="mvc-grid-popup"><\/div>')});