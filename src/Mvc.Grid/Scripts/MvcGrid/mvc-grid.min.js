/*!
 * Mvc.Grid 6.0.0
 * https://github.com/NonFactors/MVC5.Grid
 *
 * Copyright Â© NonFactors
 *
 * Licensed under the terms of the MIT License
 * http://www.opensource.org/licenses/mit-license.php
 */
function MvcGridExtends(n,t){function i(){this.constructor=n}Object.setPrototypeOf(n,t);n.prototype=(i.prototype=t.prototype,new i)}var MvcGrid=function(){function n(n,t){var i,u,r;if(t=t||{},n=this.findGrid(n),n.dataset.id)return this.instances[parseInt(n.dataset.id)].set(t);i=this;i.columns=[];i.element=n;i.loadingDelay=300;i.showLoading=!0;i.requestType="get";i.name=n.dataset.name;i.popup=new MvcGridPopup(i);i.filterMode=n.dataset.filterMode;i.prefix=i.name?i.name+"-":"";i.sourceUrl=i.element.dataset.sourceUrl;i.element.dataset.id=t.id||i.instances.length;i.filters={"enum":MvcGridEnumFilter,date:MvcGridDateFilter,guid:MvcGridGuidFilter,text:MvcGridTextFilter,number:MvcGridNumberFilter,boolean:MvcGridBooleanFilter};u=n.querySelectorAll(".mvc-grid-row-filters th");[].forEach.call(n.querySelectorAll(".mvc-grid-headers th"),function(n,t){i.columns.push(new MvcGridColumn(i,n,u[t]))});r=n.querySelector(".mvc-grid-pager");r&&(i.pager=new MvcGridPager(i,r));t.id?i.instances[parseInt(t.id)]=i:i.instances.push(i);i.set(t);i.cleanUp();i.bind();i.sourceUrl&&!n.children.length&&i.reload()}return n.prototype={instances:[],lang:{text:{contains:"Contains",equals:"Equals","not-equals":"Not equals","starts-with":"Starts with","ends-with":"Ends with"},number:{equals:"Equals","not-equals":"Not equals","less-than":"Less than","greater-than":"Greater than","less-than-or-equal":"Less than or equal","greater-than-or-equal":"Greater than or equal"},date:{equals:"Equals","not-equals":"Not equals","earlier-than":"Earlier than","later-than":"Later than","earlier-than-or-equal":"Earlier than or equal","later-than-or-equal":"Later than or equal"},"enum":{equals:"Equals","not-equals":"Not equals"},guid:{equals:"Equals","not-equals":"Not equals"},boolean:{equals:"Equals","not-equals":"Not equals"},filter:{apply:"&#10004;",remove:"&#10008;"},operator:{select:"",and:"and",or:"or"}},findGrid:function(n){for(var t=n;t&&!t.classList.contains("mvc-grid");)t=t.parentElement;if(!t)throw new Error("Grid can only be created from within mvc-grid structure.");return t},set:function(n){var t=this,r=n.filters||{},u,i;for(u in r)t.filters[u]=r[u];return t.columns.forEach(function(n){n.filter&&(r.hasOwnProperty(n.filter.name)||!n.filter.instance)&&(n.filter.instance=new t.filters[n.filter.name](n),n.filter.instance.init())}),t.requestType=n.requestType||t.requestType,t.sourceUrl=n.sourceUrl===undefined?t.sourceUrl:n.sourceUrl,t.showLoading=n.showLoading===undefined?t.showLoading:n.showLoading,t.loadingDelay=n.loadingDelay===undefined?t.loadingDelay:n.loadingDelay,t.sourceUrl?(i=t.sourceUrl.split("?",2),t.sourceUrl=i[0],n.query!==undefined?t.query=new MvcGridQuery(n.query):(i[1]||!t.query)&&(t.query=new MvcGridQuery(i[1]))):t.query=n.query!==undefined?new MvcGridQuery(n.query):new MvcGridQuery(window.location.search),this},reload:function(){var t=this;t.element.dispatchEvent(new CustomEvent("reloadstart",{detail:{grid:t},bubbles:!0}));t.sourceUrl?t.startLoading(function(i){for(var u=-1,f=t.element.parentElement,r;f.children[++u]!=t.element;);t.element.outerHTML=i;r=new n(f.children[u],{loadingDelay:t.loadingDelay,showLoading:t.showLoading,requestType:t.requestType,query:t.query.toString(),id:t.element.dataset.id,sourceUrl:t.sourceUrl,filters:t.filters});r.element.dispatchEvent(new CustomEvent("reloadend",{detail:{grid:r},bubbles:!0}))},function(n){t.element.dispatchEvent(new CustomEvent("reloadfail",{detail:{grid:t,result:n},bubbles:!0}))}):window.location.href=window.location.origin+window.location.pathname+"?"+t.query},startLoading:function(n,t){var i=this,r;i.stopLoading();i.showLoading&&!i.element.querySelector(".mvc-grid-loader")&&(r=document.createElement("div"),r.appendChild(document.createElement("div")),r.appendChild(document.createElement("div")),r.appendChild(document.createElement("div")),i.loader=document.createElement("div"),i.loader.className="mvc-grid-loader",i.loader.appendChild(r),i.loading=setTimeout(function(){i.loader.classList.add("mvc-grid-loading")},i.loadingDelay),i.element.appendChild(i.loader));i.request=new XMLHttpRequest;i.request.open(i.requestType,i.sourceUrl+"?"+i.query+"&_="+Date.now(),!0);i.request.setRequestHeader("X-Requested-With","XMLHttpRequest");i.request.onload=function(){200<=i.request.status&&i.request.status<400?n(i.request.responseText):t&&t(i.request.responseText)};i.request.onerror=t;i.request.send()},stopLoading:function(){var n=this;n.request&&n.request.readyState!=4&&n.request.abort();clearTimeout(n.loading);n.loader&&n.loader.parentElement.removeChild(n.loader)},bind:function(){var n=this;[].forEach.call(n.element.querySelectorAll("tbody tr"),function(t){t.classList.contains("mvc-grid-empty-row")||t.addEventListener("click",function(i){var r={};n.columns.forEach(function(n,i){r[n.name]=t.cells[i].innerText});this.dispatchEvent(new CustomEvent("rowclick",{detail:{grid:n,data:r,originalEvent:i},bubbles:!0}))})})},cleanUp:function(){delete this.element.dataset.sourceUrl;delete this.element.dataset.filterMode}},n}(),MvcGridColumn=function(){function n(n,t,i){var u=this,r=t.dataset,f;u.grid=n;u.header=t;u.name=r.name;u.rowFilter=i;r.filter=="True"&&(f=t.querySelector(".mvc-grid-options"),f?f.parentElement.removeChild(f):n.filterMode=="FilterRow"&&(f=i.querySelector("select.mvc-grid-value")),u.filter={hasOptions:f&&f.children.length>0,isMulti:r.filterMulti=="True",operator:r.filterOperator,name:r.filterName,options:f,first:{method:r.filterFirstMethod,value:r.filterFirstValue},second:{method:r.filterSecondMethod,value:r.filterSecondValue}});r.sort=="True"&&n.filterMode!="HeaderRow"&&(u.sort={first:r.sortFirst,order:r.sortOrder});u.bindFilter();u.bindSort();u.cleanUp()}return n.prototype={cancelFilter:function(){if(this.filter.first.method||this.filter.second.method){var n=this.grid;n.query.delete(n.prefix+"page");n.query.delete(n.prefix+"rows");n.query.deleteStartingWith(n.prefix+this.name+"-");n.reload()}},applyFilter:function(){var n=this.grid;n.query.delete(n.prefix+"page");n.query.delete(n.prefix+"rows");n.query.deleteStartingWith(n.prefix+this.name+"-");n.query.append(n.prefix+this.name+"-"+this.filter.first.method,this.filter.first.value);n.filterMode=="ExcelRow"&&this.filter.isMulti&&(n.query.append(n.prefix+this.name+"-op",this.filter.operator),n.query.append(n.prefix+this.name+"-"+this.filter.second.method,this.filter.second.value));n.pager&&n.pager.showPageSizes&&n.query.append(n.prefix+"rows",n.pager.rowsPerPage.value);n.reload()},applySort:function(){var t=this,n=this.grid,i;n.query.delete(n.prefix+"sort");n.query.delete(n.prefix+"order");n.query.append(n.prefix+"sort",this.name);i=t.sort.order=="asc"?"desc":"asc";!t.sort.order&&t.sort.first&&(i=t.sort.first);n.query.append(n.prefix+"order",i);n.reload()},bindFilter:function(){var n=this,t;n.filter&&(t=(n.rowFilter||n.header).querySelector(".mvc-grid-filter"),t.addEventListener("click",function(){n.filter.instance.show()}))},bindSort:function(){var n=this;n.sort&&n.header.addEventListener("click",function(t){t.target.classList.contains("mvc-grid-filter")||n.applySort()})},cleanUp:function(){var n=this.header.dataset;delete n.filterSecondMethod;delete n.filterSecondValue;delete n.filterFirstMethod;delete n.filterFirstValue;delete n.filterOperator;delete n.filterMulti;delete n.filterName;delete n.filter;delete n.sortOrder;delete n.sortFirst;delete n.sort;delete n.name}},n}(),MvcGridPager=function(){function n(n,t){var i=this;i.grid=n;i.element=t;i.pages=t.querySelectorAll("[data-page]");i.showPageSizes=t.dataset.showPageSizes=="True";i.rowsPerPage=t.querySelector(".mvc-grid-pager-rows");i.currentPage=i.pages.length?parseInt(t.querySelector(".active").dataset.page):1;i.cleanUp();i.bind()}return n.prototype={apply:function(n){var t=this.grid;t.query.delete(t.prefix+"page");t.query.delete(t.prefix+"rows");t.query.append(t.prefix+"page",n);this.showPageSizes&&t.query.append(t.prefix+"rows",this.rowsPerPage.value);t.reload()},bind:function(){var n=this;[].forEach.call(n.pages,function(t){t.addEventListener("click",function(){n.apply(this.dataset.page)})});n.rowsPerPage.addEventListener("change",function(){n.apply(n.currentPage)})},cleanUp:function(){delete this.element.dataset.showPageSizes}},n}(),MvcGridPopup=function(){function n(n){this.element.className="mvc-grid-popup";this.grid=n;this.bind()}return n.prototype={element:document.createElement("div"),updatePosition:function(n){var t=(n.rowFilter||n.header).querySelector(".mvc-grid-filter"),u=this.element.querySelector(".popup-arrow"),f=t.getBoundingClientRect(),e=this.element.clientWidth,s=window.pageYOffset+f.top+t.offsetHeight*.6+u.offsetHeight,i=window.pageXOffset+f.left-8,o=t.offsetWidth/2,r;i+e+8>window.pageXOffset+document.documentElement.clientWidth&&(r=e-t.offsetWidth-16,o+=r,i-=r);this.element.style.left=i+"px";this.element.style.top=s+"px";u.style.left=o+"px"},show:function(n){this.element.parentElement||document.body.appendChild(this.element);this.updatePosition(n)},hide:function(t){for(var i=t&&t.target;i&&!/mvc-grid-(popup|filter)/.test(i.className);)i=i.parentElement;!i&&n.prototype.element.parentNode&&document.body.removeChild(n.prototype.element)},bind:function(){window.addEventListener("click",this.hide);window.addEventListener("resize",this.hide)}},n}(),MvcGridQuery=function(){function n(n){this.query=(n||"").replace("?","")}return n.prototype={set:function(n,t){this.delete(n);this.append(n,t)},append:function(n,t){this.query+=this.query?"&":"";this.query+=encodeURIComponent(n)+"="+encodeURIComponent(t||"")},"delete":function(n){n=encodeURIComponent(n);this.query=this.query.split("&").filter(function(t){return t.split("=",1)[0]!=n}).join("&")},deleteStartingWith:function(n){n=encodeURIComponent(n);this.query=this.query.split("&").filter(function(t){return t.split("=",1)[0].indexOf(n)}).join("&")},toString:function(){return this.query}},n}(),MvcGridFilter=function(){function n(n){this.isMulti=n.filter.isMulti;this.mode=n.grid.filterMode;this.popup=n.grid.popup;this.column=n;this.methods=[]}return n.prototype={init:function(){var n=this,t=n.column,r,i;t.filter.hasOptions?n.mode=="FilterRow"?t.rowFilter.querySelector("select").addEventListener("change",function(){t.filter.first.value=this.value;n.apply()}):n.mode=="HeaderRow"&&(r=t.rowFilter.querySelector(".mvc-grid-value"),r.readOnly=!0,r.tabIndex=-1):n.mode!="ExcelRow"&&(i=t.rowFilter.querySelector(".mvc-grid-value"),i.addEventListener("input",function(){t.filter.first.value=this.value;n.validate(this)}),i.addEventListener("keyup",function(t){t.which==13&&n.apply()}),n.validate(i));t.filter.first.method=t.filter.first.method||n.methods[0];t.filter.second.method=t.filter.second.method||n.methods[0]},show:function(){var n=this;n.lang=n.column.grid.lang;n.popup.element.innerHTML=n.render();n.setValues();n.bindOperator();n.bindMethods();n.bindValues();n.bindActions();n.popup.show(n.column)},render:function(){return'<div class="popup-arrow"><\/div><div class="popup-content"><div class="popup-filter">'+this.renderFilter("first")+"<\/div>"+(this.mode=="ExcelRow"&&this.isMulti?this.renderOperator()+'<div class="popup-filter">'+this.renderFilter("second")+"<\/div>":"")+this.renderActions()+"<\/div>"},renderFilter:function(n){var t=this.column.filter.hasOptions,i=this.lang[this.column.filter.name]||{};return'<div class="popup-group"><select class="mvc-grid-method" data-filter="'+n+'">'+this.methods.map(function(n){return'<option value="'+n+'">'+(i[n]||"")+"<\/option>"}).join("")+'<\/select><\/div><div class="popup-group">'+(t?'<select class="mvc-grid-value" data-filter="'+n+'">'+this.column.filter.options.innerHTML+"<\/select>":'<input class="mvc-grid-value" data-filter="'+n+'">')+"<\/div>"},renderOperator:function(){return'<div class="popup-operator"><div class="popup-group"><select class="mvc-grid-operator"><option value="">'+this.lang.operator.select+'<\/option><option value="and">'+this.lang.operator.and+'<\/option><option value="or">'+this.lang.operator.or+"<\/option><\/select><\/div><\/div>"},renderActions:function(){return'<div class="popup-actions"><button class="mvc-grid-apply" type="button">'+this.lang.filter.apply+'<\/button><button class="mvc-grid-cancel" type="button">'+this.lang.filter.remove+"<\/button><\/div>"},setValues:function(){var n=this.column.filter;this.setValue(".mvc-grid-operator",n.operator);this.setValue('.mvc-grid-value[data-filter="first"]',n.first.value);this.setValue('.mvc-grid-value[data-filter="second"]',n.second.value);this.setValue('.mvc-grid-method[data-filter="first"]',n.first.method);this.setValue('.mvc-grid-method[data-filter="second"]',n.second.method)},setValue:function(n,t){var i=this.popup.element.querySelector(n);i&&(i.value=t)},apply:function(){this.popup.hide();this.column.applyFilter()},cancel:function(){this.popup.hide();this.column.cancelFilter()},isValid:function(){return!0},validate:function(n){this.isValid(n.value)?n.classList.remove("invalid"):n.classList.add("invalid")},bindOperator:function(){var t=this.column.filter,n=this.popup.element.querySelector(".mvc-grid-operator");n&&n.addEventListener("change",function(){t.operator=this.value})},bindMethods:function(){var n=this.column.filter;[].forEach.call(this.popup.element.querySelectorAll(".mvc-grid-method"),function(t){t.addEventListener("change",function(){n[this.dataset.filter].method=this.value})})},bindValues:function(){var n=this;[].forEach.call(n.popup.element.querySelectorAll(".mvc-grid-value"),function(t){t.addEventListener("input",function(){if(n.column.filter[this.dataset.filter].value=this.value,n.mode!="ExcelRow"){var t=n.column.rowFilter.querySelector(".mvc-grid-value");t.value=this.tagName=="SELECT"?this.options[this.selectedIndex].text:this.value;n.validate(t)}n.validate(this)});t.addEventListener("keyup",function(t){t.which==13&&n.apply()});n.validate(t)})},bindActions:function(){var n=this.popup.element;n.querySelector(".mvc-grid-apply").addEventListener("click",this.apply.bind(this));n.querySelector(".mvc-grid-cancel").addEventListener("click",this.cancel.bind(this))}},n}(),MvcGridTextFilter=function(n){function t(t){n.call(this,t);this.methods=["contains","equals","not-equals","starts-with","ends-with"]}return MvcGridExtends(t,n),t}(MvcGridFilter),MvcGridNumberFilter=function(n){function t(t){n.call(this,t);this.methods=["equals","not-equals","less-than","greater-than","less-than-or-equal","greater-than-or-equal"]}return MvcGridExtends(t,n),t.prototype.isValid=function(n){return!n||/^(?=.*\d+.*)[-+]?\d*[.,]?\d*$/.test(n)},t}(MvcGridFilter),MvcGridDateFilter=function(n){function t(t){n.call(this,t);this.methods=["equals","not-equals","earlier-than","later-than","earlier-than-or-equal","later-than-or-equal"]}return MvcGridExtends(t,n),t}(MvcGridFilter),MvcGridEnumFilter=function(n){function t(t){n.call(this,t);this.methods=["equals","not-equals"]}return MvcGridExtends(t,n),t}(MvcGridFilter),MvcGridGuidFilter=function(n){function t(t){n.call(this,t);this.methods=["equals","not-equals"]}return MvcGridExtends(t,n),t.prototype.isValid=function(n){return!n||/^[0-9A-F]{8}[-]?([0-9A-F]{4}[-]?){3}[0-9A-F]{12}$/i.test(n)},t}(MvcGridFilter),MvcGridBooleanFilter=function(n){function t(t){n.call(this,t);this.methods=["equals","not-equals"]}return MvcGridExtends(t,n),t}(MvcGridFilter);